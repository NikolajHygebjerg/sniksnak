# Sikker Chat Setup - Step by Step

## Problem
The `users` table has a foreign key constraint to `auth.users`, so we can't create a user in `public.users` unless it exists in `auth.users` first. Supabase generates UUIDs automatically when creating auth users.

## Solution: Create Auth User First, Then Update Code

### Step 1: Create Auth User in Supabase Dashboard

1. Go to **Supabase Dashboard** → **Authentication** → **Users**
2. Click **"Add User"** or **"Create User"**
3. Fill in:
   - **Email**: `sikker-chat@system.local`
   - **Password**: Generate a secure random password (you won't need to log in with this)
   - **Auto Confirm User**: ✅ (check this)
4. Click **"Create User"**
5. **IMPORTANT**: Copy the **User ID (UUID)** that Supabase generates (it will look like `49c8274a-c157-4xxx-xxxx-xxxxxxxxxxxx`)

### Step 2: Create User Record in Database

1. Go to **Supabase Dashboard** → **SQL Editor**
2. Run this SQL (replace `YOUR_UUID_HERE` with the UUID from Step 1):

```sql
-- Create the user record
INSERT INTO public.users (id, email)
VALUES ('YOUR_UUID_HERE', 'sikker-chat@system.local')
ON CONFLICT (id) DO NOTHING;

-- Add display name
UPDATE public.users
SET 
  first_name = 'Sikker',
  surname = 'Chat',
  username = 'Sikker Chat'
WHERE id = 'YOUR_UUID_HERE';

-- Verify
SELECT id, email, first_name, surname, username 
FROM public.users 
WHERE id = 'YOUR_UUID_HERE';
```

### Step 3: Update Code with Your UUID

1. Open `src/app/api/messages/scan-and-flag/route.ts`
2. Find line ~101 where it says:
   ```typescript
   const SIKKER_CHAT_USER_ID = "49c8274a-c157-0000-0000-000000000001";
   ```
3. Replace it with your actual UUID:
   ```typescript
   const SIKKER_CHAT_USER_ID = "YOUR_UUID_HERE"; // Replace with UUID from Step 1
   ```

### Step 4: Test

1. Send a message containing "jeg hader dig" from one child to another
2. Check that the recipient child's parent receives a message from "Sikker Chat"
3. The notification should include a link to view the flagged chat

## Quick Reference

- **Auth User Email**: `sikker-chat@system.local`
- **Display Name**: "Sikker Chat"
- **UUID**: (Use the one generated by Supabase in Step 1)
